<!--
    Styles defined here carry into the __preview because it's embedded HTML.
    So any styles names common to the editor's HTML will pick up the styles used in the editor!
    Javascript does not run because the document is already "ready".

let el = document.getElementById('div');

$(el).css('width')
$(el).css('width', '50%')
-->

<head>
    <script src='https://code.jquery.com/jquery-3.4.1.min.js'></script>
</head>

<style>
    /* https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom___properties */
    :root {
        --__propertyWidth: 200px;
        --__toolbarHeight: 30px;
    }

    div {
        border-style:solid;
        border-width: 1px;
    }

    table {
        border-style:solid;
        border-width: 1px;
    }

    th {
        border-style:solid;
        border-width: 1px;
    }

    tr {
        border-style:solid;
        border-width: 1px;
    }

    td {
        border-style:solid;
        border-width: 1px;
    }

    body {
        padding:0; 
        margin:0;
    }

    .__noborders {
        border-collapse: collapse;    
    }

    .__border1 {
        border-style:solid;
        border-width: 1px;
    }

/* Absolution positioning should be avoided like the plague! */
/*
    .__fullscreen {
        height: 100%;
        width: 100%; 
        position: absolute; 
        top: 0; 
        bottom: 0; 
        left: 0; 
        right: 0;
        table-layout: fixed;
    }
*/

    .__fullscreen {
        width:calc(100% - 2px); 
        height:calc(100vh - 2px);
        padding: 0;
        margin: 0;
    }

/*
    .__fullscreenv {
        height: 100%;
        width: calc(100% - (var(--__propertyWidth) + 2px)); 
        position: absolute; 
        top: 0; 
        bottom: 0; 
        left: 0; 
        right: 0;
    }
*/

    .__editorhw {
        width: calc(100% - var(--__propertyWidth));
    }

    .__properties {
        width: var(--__propertyWidth);
    }

    .__taeditorh {
        height: calc(100% - var(--__toolbarHeight));
        width: 100%;
        resize: none;
        padding: 0;
        margin: 0;
        white-space:normal;   /* or auto? */
        overflow: auto;
    }

    .__taeditorv {
        height: 100%;
        width: 100%;
        resize: none;
        padding: 0;
        margin: 0;
        white-space:normal;   /* or auto? */
        overflow: auto;
    }

    .__h100p {
        height: 100%;
    }

    .__text-bold {
        font-weight: bold;
    }

    .__mw1px {
        max-width: 1px;
    }

    .__preview {
        overflow: auto;
        white-space: normal;
    }

    .__fixed {
        table-layout: fixed;
    }

    .__fill {
        width:100%; 
        height:100%;
    }

    .__vamiddle {
        vertical-align: middle;
    }

    .__toolbar {
        height: var(--__toolbarHeight);
        width: 100%;
        padding-left: 5px;
    }

    .__parent {display: table;}

    .__child-top-left {
        display: table-cell;
    }

    .__child-middle-left {
        display: table-cell;
        vertical-align: middle;
        text-align: left;
    }

    .__child-middle-center {
        display: table-cell;
        vertical-align: middle;
        text-align: center;
    }

    .__child-bottom-right {
        display: table-cell;
        vertical-align: bottom;
        text-align: right;
    }

    .__hidden {
        display: none;
    }

</style>

<body>
    <!-- 3 Horizontal panels -->

    <div class='__fullscreen __hidden' id='__horizontalView'>    
        <div class='__parent __toolbar'>
            <div class="__child-middle-left __buttonBar"></div>
        </div>
        <table class='__noborders __fixed __fill'>
            <tr>
                <td class='__editorhw'>
                    <div class='__h100p'>
                        <textarea class='__taeditorh' id='__editorh'></textarea>
                    </div>
                </td>
                <td class='__mw1px'>
                    <div class='__preview __h100p' id='__previewh'></div>
                </td>
                <td class='__properties'>
                    <div class='__h100p __propertiesContainer'></div>
                </td>
            </tr>
        </table>
    </div>

    <!-- top and bottom editor and __preview with __properties sidebar -->

    <div class='__fullscreen' id='__verticalView'>
        <table class='__noborders __fill'>
            <tr style='height:1px;'>
                <div class='__parent __toolbar'>
                    <div class="__child-middle-left __buttonBar"></div>
                </div>
            </tr>
            <tr>
                <td>
                    <table class='__noborders __fill'>
                        <tr>
                            <td>
                                <div class='__h100p'>
                                    <textarea class='__taeditorv' id='__editorv'></textarea>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class='__mw1px'>
                                <div class='__preview __h100p' id='__previewv'></div>
                            </td>
                        </tr>
                    </table>
                </td>
                <td class='__properties'>
                    <div class='__h100p __propertiesContainer'></div>
                </td>
            </tr>
        </table>
    </div>    

    <div class='__hidden' id='__sourceButtonBar'>
        <button class='showHorizontal'>Horizontal</button>
        <button class='showVertical'>Vertical</button>
        <button class='clearEditors'>Clear</button>
    </div>

    <div class='__hidden' id = '__sourcePropertiesContainer'>
        Element: <span class='__text-bold __elementName'></span>
    </div>

</body>

<script>
$(document).ready(() => initialize());

function wireUpEvents() {
    $('#__editorh').keyup(event => editorKeyPress(event.which, '#__editorh', '#__previewh'));
    $('#__editorv').keyup(event => editorKeyPress(event.which, '#__editorv', '#__previewv'));
    $('.__preview').mouseover(event => __previewMouseOver(event.target));
    $('.__preview').mouseleave(event => clearProperties());
    $('.showHorizontal').click(() => showHorizontalLayout());
    $('.showVertical').click(() => showVerticalLayout());
    $('.clearEditors').click(() => clearEditors());
    showHorizontalLayout();
}

function initialize() {
    // Before wiring up events, setup the common containers.
    setupButtonBar();
    setup__propertiesContainer();
    wireUpEvents();
    demo();
}

function setupButtonBar() {
    let html = $('#__sourceButtonBar').html();
    $('.__buttonBar').html(html);
}

function setup__propertiesContainer() {
    let html = $('#__sourcePropertiesContainer').html();
    $('.__propertiesContainer').html(html);
}

function editorKeyPress(key, sourceEditor, target__preview) {
    let editorText = $(sourceEditor).val();
    $(target__preview).html(editorText);
}

function __previewMouseOver(element) {
    // Ignore the __preview box itself.
    if (!element.classList.contains('__preview')) {
        let tagName = element.tagName;
        console.log(tagName);
        $('.__elementName').text(tagName);
    }
    else {
        clearProperties();
    }
}

function clearProperties() {
    $('.__elementName').text('');
}

function showVerticalLayout() {
    copy('h', 'v');
    $('#__verticalView').removeClass('__hidden');
    $('#__horizontalView').addClass('__hidden');
}

function showHorizontalLayout() {
    copy('v', 'h');
    $('#__verticalView').addClass('__hidden');
    $('#__horizontalView').removeClass('__hidden');
}

function clearEditors() {
    $('#__editorh').val('');
    $('#__editorv').val('');
    $('#__previewh').html('');
    $('#__previewv').html('');
}

function demo() {
    let demoText="<style>\np {\n\n  margin: 0px 0px 0px 5px;\n}\n</style>\n<p id='hi'>Hello World!</p><div id='div'>DIV Content</div>";
    $('#__editorv').val(demoText);
    $('#__previewv').html(demoText);
    $('#__editorh').val(demoText);
    $('#__previewh').html(demoText);
}

// Copy from one editor to the other
function copy(esource, etarget) {
    let edSource = '#__editor' + esource;
    let edTarget = '#__editor' + etarget;
    let pTarget = '#__preview' + etarget;
    let editorText = $(edSource).val();
    $(edTarget).val(editorText);
    $(pTarget).html(editorText);
}

</script>